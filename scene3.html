<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Pixel Birthday - Kenangan Bersama</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: fixed;
        touch-action: manipulation;
      }

      body {
        background: linear-gradient(
          135deg,
          #ffafbd 0%,
          #ffc3a0 50%,
          #ffeaa7 100%
        );
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Courier New", monospace;
      }

      /* Animated hearts */
      .hearts {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
      }

      .heart {
        position: absolute;
        color: #ff69b4;
        font-size: clamp(15px, 2vw, 25px);
        opacity: 0.4;
        animation: floatHeart 8s infinite ease-in-out;
      }

      @keyframes floatHeart {
        0%,
        100% {
          transform: translateY(0) scale(1);
          opacity: 0.4;
        }
        50% {
          transform: translateY(-50px) scale(1.2);
          opacity: 0.7;
        }
      }

      /* Container */
      .container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1;
      }

      /* Gallery wrapper */
      .gallery-wrapper {
        position: relative;
        width: clamp(300px, 90vw, 900px);
        height: clamp(450px, 80vh, 650px);
        perspective: 1000px;
      }

      /* Title */
      .gallery-title {
        position: absolute;
        top: clamp(-50px, -8vh, -60px);
        left: 50%;
        transform: translateX(-50%);
        color: #ff1493;
        font-size: clamp(16px, 3.5vw, 32px);
        font-weight: bold;
        text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
        text-align: center;
        z-index: 100;
        animation: titleBounce 2s infinite;
        white-space: nowrap;
      }

      @keyframes titleBounce {
        0%,
        100% {
          transform: translateX(-50%) translateY(0);
        }
        50% {
          transform: translateX(-50%) translateY(-10px);
        }
      }

      /* Photo frame - Pink polaroid style */
      .photo-frame {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #fff;
        padding: clamp(12px, 2.5vw, 25px);
        padding-bottom: clamp(50px, 10vw, 90px);
        box-shadow: 0 0 0 clamp(3px, 0.5vw, 4px) #fff,
          0 0 0 clamp(6px, 0.8vw, 8px) #ff69b4,
          0 clamp(10px, 1.5vw, 12px) 0 clamp(6px, 0.8vw, 8px) #ff1493,
          0 clamp(15px, 2.5vw, 20px) clamp(30px, 5vw, 40px)
            rgba(255, 20, 147, 0.4);
        opacity: 0;
        transform: translateX(100%) rotate(10deg) scale(0.8);
        transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
      }

      .photo-frame.active {
        opacity: 1;
        transform: translateX(0) rotate(0deg) scale(1);
      }

      .photo-frame.exit-left {
        opacity: 0;
        transform: translateX(-100%) rotate(-10deg) scale(0.8);
      }

      /* Photo container */
      .photo-container {
        width: 100%;
        height: calc(100% - clamp(50px, 10vw, 90px));
        background: #ffe4e1;
        border: clamp(3px, 0.5vw, 4px) solid #ff69b4;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
      }

      .photo-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        image-rendering: auto;
      }

      /* Photo placeholder */
      .photo-placeholder {
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          45deg,
          #ffe4e1,
          #ffe4e1 10px,
          #ffc0cb 10px,
          #ffc0cb 20px
        );
        display: flex;
        justify-content: center;
        align-items: center;
        color: #ff69b4;
        font-size: clamp(12px, 2vw, 16px);
        flex-direction: column;
        gap: 10px;
      }

      /* Caption */
      .photo-caption {
        position: absolute;
        bottom: clamp(6px, 1.5vw, 12px);
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        color: #ff1493;
        font-size: clamp(10px, 1.8vw, 15px);
        text-align: center;
        font-weight: bold;
        line-height: 1.4;
        text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.8);
      }

      /* Navigation buttons */
      .nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: clamp(35px, 5vw, 55px);
        height: clamp(35px, 5vw, 55px);
        background: #ff69b4;
        border: none;
        cursor: pointer;
        font-size: clamp(18px, 2.5vw, 28px);
        color: white;
        z-index: 200;
        transition: all 0.1s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 -3px 0 0 #ffb6c1, 0 3px 0 0 #ff1493, 3px 0 0 0 #ff69b4,
          -3px 0 0 0 #ff69b4, 0 5px 0 0 rgba(0, 0, 0, 0.3);
        image-rendering: pixelated;
      }

      .nav-btn:hover {
        transform: translateY(-50%) scale(1.1);
        background: #ff1493;
      }

      .nav-btn:active {
        transform: translateY(-48%) scale(1.05);
        box-shadow: 0 -3px 0 0 #ff69b4, 0 3px 0 0 #c71585, 3px 0 0 0 #ff1493,
          -3px 0 0 0 #ff1493, 0 2px 0 0 rgba(0, 0, 0, 0.3);
      }

      .nav-btn.disabled {
        opacity: 0.3;
        pointer-events: none;
      }

      .nav-btn.prev {
        left: clamp(-40px, -6vw, -65px);
      }

      .nav-btn.next {
        right: clamp(-40px, -6vw, -65px);
      }

      /* Progress indicator */
      .progress-indicator {
        position: absolute;
        bottom: clamp(-40px, -6vh, -50px);
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: clamp(6px, 1.2vw, 10px);
        z-index: 100;
      }

      .progress-dot {
        width: clamp(10px, 1.8vw, 14px);
        height: clamp(10px, 1.8vw, 14px);
        background: rgba(255, 255, 255, 0.5);
        border: 2px solid #ff69b4;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(255, 105, 180, 0.3);
      }

      .progress-dot.active {
        background: #ff1493;
        transform: scale(1.3);
        box-shadow: 0 0 15px rgba(255, 20, 147, 0.8);
      }

      .progress-dot:hover {
        transform: scale(1.2);
      }

      /* Birthday Cake Scene */
      .cake-scene {
        position: absolute;
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg, #fff0f5 0%, #ffe4e1 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        opacity: 0;
        transform: scale(0.8);
        transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 0 0 clamp(3px, 0.5vw, 4px) #fff,
          0 0 0 clamp(6px, 0.8vw, 8px) #ff69b4,
          0 clamp(10px, 1.5vw, 12px) 0 clamp(6px, 0.8vw, 8px) #ff1493,
          0 clamp(15px, 2.5vw, 20px) clamp(30px, 5vw, 40px)
            rgba(255, 20, 147, 0.4);
        overflow: hidden;
      }

      .cake-scene.active {
        opacity: 1;
        transform: scale(1);
      }

      .cake-title {
        font-size: clamp(18px, 4vw, 36px);
        color: #ff1493;
        margin-bottom: clamp(10px, 2vh, 20px);
        font-weight: bold;
        text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.8);
        animation: textPulse 2s infinite;
      }

      @keyframes textPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Interactive Birthday Cake */
      .birthday-cake {
        position: relative;
        width: clamp(200px, 40vw, 300px);
        height: clamp(250px, 45vh, 350px);
        margin: clamp(15px, 3vh, 30px) 0;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .birthday-cake:hover {
        transform: scale(1.05);
      }

      /* Cake layers */
      .cake-layer {
        position: absolute;
        width: 100%;
        left: 0;
        border: 3px solid #ff1493;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(20px, 4vw, 40px);
      }

      .cake-layer-1 {
        bottom: 0;
        height: 25%;
        background: linear-gradient(180deg, #ff69b4 0%, #ff1493 100%);
      }

      .cake-layer-2 {
        bottom: 25%;
        height: 25%;
        width: 85%;
        left: 7.5%;
        background: linear-gradient(180deg, #ffb6c1 0%, #ff69b4 100%);
      }

      .cake-layer-3 {
        bottom: 50%;
        height: 25%;
        width: 70%;
        left: 15%;
        background: linear-gradient(180deg, #ffc0cb 0%, #ffb6c1 100%);
      }

      /* Candles */
      .candles {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: clamp(8px, 2vw, 15px);
        z-index: 10;
      }

      .candle {
        position: relative;
        width: clamp(8px, 1.5vw, 12px);
        height: clamp(40px, 8vh, 60px);
        background: linear-gradient(180deg, #fff 0%, #ffe4e1 50%, #ffb6c1 100%);
        border: 2px solid #ff69b4;
        animation: candleWiggle 2s infinite;
      }

      .candle:nth-child(2) {
        animation-delay: 0.3s;
      }
      .candle:nth-child(3) {
        animation-delay: 0.6s;
      }
      .candle:nth-child(4) {
        animation-delay: 0.9s;
      }
      .candle:nth-child(5) {
        animation-delay: 1.2s;
      }

      @keyframes candleWiggle {
        0%,
        100% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(-2deg);
        }
        75% {
          transform: rotate(2deg);
        }
      }

      /* Flame */
      .flame {
        position: absolute;
        top: -clamp(12px, 2vh, 18px);
        left: 50%;
        transform: translateX(-50%);
        width: clamp(12px, 2vw, 18px);
        height: clamp(18px, 3vh, 25px);
        background: radial-gradient(
          circle,
          #ffff00 0%,
          #ff6347 50%,
          #ff1493 100%
        );
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: flameFlicker 0.3s infinite alternate;
        opacity: 1;
        transition: opacity 0.3s;
      }

      .flame.blown {
        opacity: 0;
        animation: flameBlow 0.5s forwards;
      }

      @keyframes flameFlicker {
        0% {
          transform: translateX(-50%) scale(1) translateY(0);
          box-shadow: 0 0 10px #ff6347;
        }
        100% {
          transform: translateX(-50%) scale(1.1) translateY(-2px);
          box-shadow: 0 0 20px #ff6347;
        }
      }

      @keyframes flameBlow {
        0% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
        50% {
          transform: translateX(20px) scale(1.5, 0.5);
          opacity: 0.5;
        }
        100% {
          transform: translateX(40px) scale(2, 0.2);
          opacity: 0;
        }
      }

      /* Instruction */
      .cake-instruction {
        font-size: clamp(11px, 2vw, 16px);
        color: #ff1493;
        margin-top: clamp(10px, 2vh, 20px);
        animation: instructionBlink 1.5s infinite;
        padding: clamp(8px, 1.5vw, 12px) clamp(15px, 3vw, 25px);
        background: rgba(255, 255, 255, 0.7);
        border: 2px solid #ff69b4;
        border-radius: 20px;
      }

      @keyframes instructionBlink {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      /* Final message after blowing */
      .final-message {
        position: absolute;
        width: 90%;
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.8s;
        pointer-events: none;
      }

      .final-message.show {
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }

      .final-text {
        font-size: clamp(12px, 2.2vw, 18px);
        color: #2c3e50;
        line-height: 1.6;
        margin: clamp(8px, 1.5vh, 15px) 0;
        background: rgba(255, 255, 255, 0.9);
        padding: clamp(10px, 2vw, 20px);
        border-radius: 15px;
        border: 2px solid #ff69b4;
      }

      .final-from {
        font-size: clamp(14px, 2.5vw, 22px);
        color: #ff1493;
        font-weight: bold;
        margin-top: clamp(10px, 2vh, 20px);
        font-style: italic;
      }

      .final-from::before {
        content: "~ ";
      }

      /* Confetti */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        pointer-events: none;
        z-index: 300;
      }

      @keyframes confettiFall {
        to {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* Sound toggle */
      .sound-toggle {
        position: absolute;
        top: clamp(12px, 2vh, 18px);
        right: clamp(12px, 2vw, 18px);
        width: clamp(35px, 5vw, 45px);
        height: clamp(35px, 5vw, 45px);
        background: rgba(255, 255, 255, 0.9);
        border: 3px solid #ff69b4;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(18px, 2.5vw, 22px);
        transition: all 0.3s;
        z-index: 400;
        box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
      }

      .sound-toggle:hover {
        background: #ffe4e1;
        transform: scale(1.1) rotate(10deg);
      }

      /* Back button */
      .back-btn {
        position: absolute;
        top: clamp(12px, 2vh, 18px);
        left: clamp(12px, 2vw, 18px);
        background: #ff69b4;
        color: white;
        padding: clamp(6px, 1.2vw, 10px) clamp(12px, 2.5vw, 18px);
        border: none;
        cursor: pointer;
        font-size: clamp(10px, 1.8vw, 13px);
        font-weight: bold;
        font-family: "Courier New", monospace;
        z-index: 400;
        box-shadow: 0 -3px 0 0 #ffb6c1, 0 3px 0 0 #ff1493, 3px 0 0 0 #ff69b4,
          -3px 0 0 0 #ff69b4, 0 4px 0 0 rgba(0, 0, 0, 0.3);
        transition: all 0.1s;
      }

      .back-btn:hover {
        transform: translateY(-2px);
        background: #ff1493;
      }

      .back-btn:active {
        transform: translateY(2px);
        box-shadow: 0 -3px 0 0 #ff69b4, 0 3px 0 0 #c71585, 3px 0 0 0 #ff1493,
          -3px 0 0 0 #ff1493, 0 1px 0 0 rgba(0, 0, 0, 0.3);
      }

      /* Transition overlay */
      .transition {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.6s;
      }

      .transition.active {
        opacity: 1;
        pointer-events: all;
      }

      /* Mobile optimizations */
      @media (max-width: 768px) {
        .gallery-title {
          white-space: normal;
          line-height: 1.3;
        }

        .nav-btn.prev {
          left: clamp(-25px, -4vw, -35px);
        }

        .nav-btn.next {
          right: clamp(-25px, -4vw, -35px);
        }

        .birthday-cake {
          width: 70vw;
          height: 60vw;
        }
      }

      @media (max-width: 480px) {
        .candles {
          gap: 5px;
        }

        .photo-frame {
          padding: 10px;
          padding-bottom: 40px;
        }
      }

      @media (max-height: 600px) and (orientation: landscape) {
        .gallery-wrapper {
          height: 85vh;
        }

        .gallery-title {
          top: -35px;
          font-size: clamp(14px, 3vh, 20px);
        }

        .birthday-cake {
          height: 60vh;
          width: 35vh;
        }
      }

      @media (min-width: 1400px) {
        .gallery-wrapper {
          width: 1000px;
          height: 700px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Hearts background -->
    <div class="hearts" id="hearts"></div>

    <div class="container">
      <!-- Sound toggle -->
      <div class="sound-toggle" id="soundToggle">üîä</div>

      <!-- Back button -->
      <button class="back-btn" id="backBtn">‚Üê Kembali</button>

      <!-- Gallery wrapper -->
      <div class="gallery-wrapper">
        <!-- Title -->
        <div class="gallery-title">üíù Kenangan Bersama Kita üíù</div>

        <!-- Photo frames (will be generated by JS) -->
        <div id="photoFrames"></div>

        <!-- Birthday Cake Scene -->
        <div class="cake-scene" id="cakeScene">
          <div class="cake-title">üéÇ Happy Birthday Electra! üéÇ</div>

          <div class="birthday-cake" id="birthdayCake">
            <!-- Candles -->
            <div class="candles">
              <div class="candle"><div class="flame"></div></div>
              <div class="candle"><div class="flame"></div></div>
              <div class="candle"><div class="flame"></div></div>
              <div class="candle"><div class="flame"></div></div>
              <div class="candle"><div class="flame"></div></div>
            </div>

            <!-- Cake layers -->
            <div class="cake-layer cake-layer-3">üå∏</div>
            <div class="cake-layer cake-layer-2">üéÄ</div>
            <div class="cake-layer cake-layer-1">üíñ</div>
          </div>

          <div class="cake-instruction" id="cakeInstruction">
            üéà Klik kue untuk meniup lilin! üéà
          </div>

          <!-- Final message -->
          <div class="final-message" id="finalMessage">
            <div class="final-text">
              Terima kasih untuk 1 bulan persahabatan! Happy Birthday bestie! üéÇ
            </div>
            <div class="final-text">
              Semoga kita bisa terus bermain bersama dan membuat lebih banyak
              kenangan indah! ‚ú®
            </div>
            <div class="final-from">Andi Aliyah</div>
          </div>
        </div>

        <!-- Navigation buttons -->
        <button class="nav-btn prev" id="prevBtn">‚óÄ</button>
        <button class="nav-btn next" id="nextBtn">‚ñ∂</button>

        <!-- Progress indicator -->
        <div class="progress-indicator" id="progressIndicator"></div>
      </div>
    </div>

    <!-- Transition overlay -->
    <div class="transition" id="transition"></div>

    <script>
      // Memory data
      const memories = [
        {
          image: "assets/memory1.png",
          caption: "Pertama kali kita main bareng di Roblox! üéÆ",
        },
        {
          image: "assets/memory2.png",
          caption: "Moment seru kita di game Tower of Hell üóº",
        },
        {
          image: "assets/memory3.png",
          caption: "Build rumah impian bareng di Bloxburg üè†",
        },
        {
          image: "assets/memory4.png",
          caption: "Ketika kita jadi team terbaik! üëæ‚ú®",
        },
      ];

      // State
      let currentIndex = 0;
      let soundEnabled = true;
      let candlesBlown = 0;

      // Elements
      const photoFramesContainer = document.getElementById("photoFrames");
      const progressIndicator = document.getElementById("progressIndicator");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const cakeScene = document.getElementById("cakeScene");
      const birthdayCake = document.getElementById("birthdayCake");
      const cakeInstruction = document.getElementById("cakeInstruction");
      const finalMessage = document.getElementById("finalMessage");
      const soundToggle = document.getElementById("soundToggle");
      const backBtn = document.getElementById("backBtn");
      const transition = document.getElementById("transition");
      const hearts = document.getElementById("hearts");

      // Create hearts
      function createHearts() {
        const heartCount = window.innerWidth < 768 ? 15 : 25;
        const heartSymbols = ["üíñ", "üíó", "üíï", "üíì", "üíù"];

        for (let i = 0; i < heartCount; i++) {
          const heart = document.createElement("div");
          heart.className = "heart";
          heart.textContent =
            heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
          heart.style.left = Math.random() * 100 + "%";
          heart.style.top = Math.random() * 100 + "%";
          heart.style.animationDelay = Math.random() * 8 + "s";
          heart.style.animationDuration = Math.random() * 6 + 6 + "s";
          hearts.appendChild(heart);
        }
      }

      createHearts();

      // Sound effects
      function playSound(frequency, duration, type = "sine") {
        if (!soundEnabled) return;

        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;

          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
          console.log("Audio not supported");
        }
      }

      // Play melody
      function playMelody() {
        const notes = [
          { freq: 523.25, time: 0 },
          { freq: 523.25, time: 200 },
          { freq: 587.33, time: 400 },
          { freq: 523.25, time: 600 },
          { freq: 698.46, time: 800 },
          { freq: 659.25, time: 1000 },
        ];

        notes.forEach((note) => {
          setTimeout(() => playSound(note.freq, 0.3, "sine"), note.time);
        });
      }

      // Create confetti
      function createConfetti() {
        const colors = [
          "#FF69B4",
          "#FF1493",
          "#FFB6C1",
          "#FFC0CB",
          "#FFD700",
          "#FF69B4",
        ];
        const confettiCount = window.innerWidth < 768 ? 40 : 60;
        for (let i = 0; i < confettiCount; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "%";
            confetti.style.top = "-10px";
            confetti.style.background =
              colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = Math.random() * 10 + 5 + "px";
            confetti.style.height = confetti.style.width;
            confetti.style.animation = `confettiFall ${
              Math.random() * 2 + 3
            }s linear forwards`;
            confetti.style.opacity = "1";
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 5000);
          }, i * 20);
        }
      }
      // Generate photo frames
      function generatePhotoFrames() {
        memories.forEach((memory, index) => {
          const frame = document.createElement("div");
          frame.className = "photo-frame";

          frame.innerHTML = `
      <div class="photo-container">
        <img 
          src="${memory.image}" 
          alt="Memory ${index + 1}"
          onerror="this.parentElement.innerHTML='<div class=photo-placeholder>Foto ${
            index + 1
          }<br>üì∏</div>'"
        >
      </div>
      <div class="photo-caption">${memory.caption}</div>
    `;

          photoFramesContainer.appendChild(frame);
        });
      }

      // Generate progress dots
      function generateProgressDots() {
        for (let i = 0; i < memories.length; i++) {
          const dot = document.createElement("div");
          dot.className = "progress-dot";
          if (i === 0) dot.classList.add("active");

          dot.addEventListener("click", () => goToSlide(i));
          progressIndicator.appendChild(dot);
        }
      }

      // Update display
      function updateDisplay() {
        const frames = document.querySelectorAll(".photo-frame");
        const dots = document.querySelectorAll(".progress-dot");

        frames.forEach((frame, index) => {
          frame.classList.remove("active", "exit-left");
          if (index === currentIndex) frame.classList.add("active");
          else if (index < currentIndex) frame.classList.add("exit-left");
        });

        dots.forEach((dot, index) => {
          dot.classList.toggle("active", index === currentIndex);
        });

        prevBtn.classList.toggle("disabled", currentIndex === 0);
        nextBtn.classList.toggle("disabled", currentIndex >= memories.length);

        if (currentIndex === memories.length) {
          cakeScene.classList.add("active");
          playSound(523.25, 0.3, "sine");
        } else {
          cakeScene.classList.remove("active");
        }
      }

      // Go to specific slide
      function goToSlide(index) {
        if (index >= 0 && index <= memories.length) {
          currentIndex = index;
          updateDisplay();
          playSound(600, 0.1, "square");
        }
      }

      // Blow candle
      birthdayCake.addEventListener("click", () => {
        const flames = document.querySelectorAll(".flame:not(.blown)");
        if (!flames.length) return;

        flames[0].classList.add("blown");
        candlesBlown++;

        playSound(300 - candlesBlown * 30, 0.4, "sine");

        if (candlesBlown >= 5) {
          setTimeout(() => {
            cakeInstruction.style.opacity = "0";
            finalMessage.classList.add("show");
            createConfetti();
            playMelody();
          }, 500);
        }
      });

      // Navigation
      prevBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateDisplay();
          playSound(500, 0.1, "square");
        }
      });

      nextBtn.addEventListener("click", () => {
        if (currentIndex < memories.length) {
          currentIndex++;
          updateDisplay();
          playSound(700, 0.1, "square");
        }
      });

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") prevBtn.click();
        if (e.key === "ArrowRight") nextBtn.click();
      });

      // Touch swipe
      let touchStartX = 0;
      document.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });
      document.addEventListener("touchend", (e) => {
        const touchEndX = e.changedTouches[0].screenX;
        if (touchEndX < touchStartX - 50) nextBtn.click();
        if (touchEndX > touchStartX + 50) prevBtn.click();
      });

      // Sound toggle
      soundToggle.addEventListener("click", () => {
        soundEnabled = !soundEnabled;
        soundToggle.textContent = soundEnabled ? "üîä" : "üîá";
        playSound(800, 0.1, "square");
      });

      // Back button
      backBtn.addEventListener("click", () => {
        playSound(400, 0.2, "square");
        transition.classList.add("active");
        setTimeout(() => window.history.back(), 600);
      });

      // Initialize
      generatePhotoFrames();
      generateProgressDots();
      updateDisplay();

      setTimeout(() => playSound(440, 0.3, "sine"), 500);

      // Prevent double-tap zoom
      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        (e) => {
          const now = Date.now();
          if (now - lastTouchEnd <= 300) e.preventDefault();
          lastTouchEnd = now;
        },
        false
      );
    </script>
  </body>
</html>
